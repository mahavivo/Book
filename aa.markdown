第1章 导言
==========

> 在本书的开篇，我们首先概要地介绍 C 语言，主要是通过实际的程序引入 C
> 语言的基本
> 元素，至于其中的具体细节、规则以及一些例外情况，在此暂时不多做讨论。因此，本章不
> 准备完整、详细地讨论 C
> 语言中的一些技术（当然，这里所举的所有例子都是正确的）。我们
> 是希望读者能尽快地编写出有用的程序，为此，本章将重点介绍一些基本概念，比如变量与
> 常量、算术运算、控制流、函数、基本输入／输出等。而对于编写较大型程序所涉及到的一
> 些重要特性，比如指针、结构、C
> 语言中十分丰富的运算符集合、部分控制流语句以及标准库
> 等，本章将暂不做讨论。
>
> 这种讲解方式也有缺点。应当提请注意的是，在本章的内容中无法找到任何特定语言特
> 性的完整说明，并且，由于比较简略，可能会使读者产生一些误解；再者，由于所举的例子
> 并没有用到 C
> 语言的所有强大功能，因此，这些例子也许并不简洁、精炼。虽然我们已经尽
> 力将这些问题的影响降到最低，但问题肯定还是存在。另一个不足之处在于，本章所讲的某
> 些内容在后续相关章节还必须再次讲述。我们希望这种重复给读者带来的帮助效果远远超过
> 它的负面影响。
>
> 无论是利还是弊，一个经验丰富的程序员应该可以从本章介绍的内容中推知他们自己进
> 行程序设计所需要的一些基本元素。初学者应编写一些类似的小程序作为本章内容的补充练
> 习。无论是经验丰富的程序员还是初学者，都可以把本章作为后续各章详细讲解的内容的框
> 架。

1.1. 入门
---------

> 学习一门新程序设计语言的惟一途径就是使用它编写程序。对于所有语言的初学者来说，
> 编写的第一个程序几乎都是相同的，即：

请打印出下列内容

hello, world

> 尽管这个练习很简单，但对于初学语言的人来说，它仍然可能成为一大障碍，因为要实
> 现这个目的，我们首先必须编写程序文本，然后成功地运行编译，并加载、运行，最后输出
> 到某个地方。掌握了这些操作细节以后，其它事情就比较容易了。

在 C 语言中，我们可以用下列程序打印出"hello, world"：

\#include \<stdio.h\>

main()

{

> printf(\"hello, world\\n\");

}

如何运行这个程序取决于所使用的系统。这里举一个特殊的例子。在 UNIX
操作系统中，

> 首先必须在某个文件中建立这个源程序，并以".c"作为文件的扩展名，例如
> hello.c，然
>
> 后再通过下列命令进行编译：
>
> cc hello.c
>
> 如果源程序没有什么错误（例如漏掉字符或拼错字符），编译过程将顺利进行，并生成一个可
>
> 执行文件 a.out。然后，我们输入： a.out
>
> 即可运行 a.out，打印出下列信息：
>
> hello, world
>
> 在其它操作系统中，编译、加载、运行等规则会有所不同。
>
> \#include \<stdio.h\> main()
>
> {
>
> printf(\"hello, world\\n\");
>
> }

包含标准库的信息

> 定义名为 main 的函数，它不接受参数值 main 函数的语句都被括在花括号中

main 函数调用库函数 printf 以显示字符序列；

\\n 代表换行符

> **第一个 C 语言程序**
>
> 下面对程序本身做些说明。一个 C
> 语言程序，无论其大小如何，都是由函数和变量组成
> 的。函数中包含一些语句，以指定所要执行的计算操作；变量则用于存储计算过程中使用的
> 值。C 语言中的函数类似于 Fortran 语言中的子程序和函数，与 Pascal
> 语言中的过程和函数也 很类似。在本例中，函数的名字为
> main。通常情况下，函数的命名没有限制，但 main 是一
> 个特殊的函数名------每个程序都从 main
> 函数的起点开始执行，这意味着每个程序都必须在某 个位置包含一个 main
> 函数。
>
> main
> 函数通常会调用其它函数来帮助完成某些工作，被调用的函数可以是程序设计人员
>
> 自己编写的，也可以来自于函数库。上述程序段中的第一行语句
>
> \#include \<stdio.h\>
>
> 用于告诉编译器在本程序中包含标准输入／输出库的信息。许多 C
> 语言源程序的开始处都包
>
> 含这一行语句。我们将在第 7 章和附录 B 中对标准库进行详细介绍。
>
> 函数之间进行数据交换的一种方法是调用函数向被调用函数提供一个值（称为参数）列
> 表。函数名后面的一对圆括号将参数列表括起来。在本例中，main
> 函数不需要任何参数，因 此用空参数表()表示。
>
> 函数中的语句用一对花括号{}括起来。本例中的 main
> 函数仅包含下面一条语句：
>
> printf(\"hello, world\\n\");
>
> 调用函数时，只需要使用函数名加上用圆括号括起来的参数表即可。上面这条语句将\"hello,
> world\\n\"。作为参数调用 printf 函数。printf
> 是一个用于打印输出的库函数，在此处， 它打印双引号中间的字符串。
>
> 用双引号括起来的字符序列称为字符串或字符串常量，如\"hello,
> world\\n\"就是一个
>
> 字符串。目前我们仅使用字符串作为 printf 及其它函数的参数。
>
> 在 C 语言中，字符序列\\n
> 表示换行符，在打印中遇到它时，输出打印将换行，从下一行
> 的左端行首开始。如果去掉字符串中的\\n（这是个值得一做的练习），即使输出打印完成后也
> 不会换行。在 printf 函数的参数中，只能用\\n
> 表示换行符。如果用程序的换行代替\\n，例
>
> 如：

printf(\"hello, world \");

> C 编译器将会产生一条错误信息。
>
> printf
> 函数永远不会自动换行，这样我们可以多次调用该函数以分阶段得到一个长的输
> 出行。上面给出的第一个程序也可以改写成下列形式：

\#include \<stdio.h\> main()

{

> printf(\"hello, \");
>
> printf(\"world\");
>
> printf(\"\\n\");

}

> 这段程序与前面的程序的输出相同。
>
> 请注意，\\n 只代表一个字符。类似于\\n
> 的转义字符序列为表示无法输入的字符或不可见
> 字符提供了一种通用的可扩充的机制。除此之外，C
> 语言提供的转义字符序列还包括：\\t 表 示制表符；\\b
> 表示回退符；\\\"表示双引号；\\\\表示反斜杠符本身。2.3
> 节将给出转义字符序 列的完整列表。

**练习 1-1** 在你自己的系统中运行"hello,
world"程序。再有意去掉程序中的部分

> 内容，看看会得到什么出错信息。

**练习 1-2** 做个实验，当 printf 函数的参数字符串中包含\\c（其中 c
是上面的转义

> 字符序列中未曾列出的某一个字符）时，观察一下会出现什么情况。

1.2. 变量与算术表达式
---------------------

我们来看下一个程序，使用公式℃=(5/9)(℉-32)打印下列华氏温度与摄氏温度对照表：

+-------+-------+
| > 1   | > -17 |
+=======+=======+
| > 20  | > -6  |
+-------+-------+
| > 40  | > 4   |
+-------+-------+
| > 60  | > 15  |
+-------+-------+
| > 80  | > 26  |
+-------+-------+
| > 100 | > 37  |
+-------+-------+
| > 120 | > 48  |
+-------+-------+
| > 140 | > 60  |
+-------+-------+
| > 160 | > 71  |
+-------+-------+
| > 180 | > 82  |
+-------+-------+
| > 200 | > 93  |
+-------+-------+
| > 220 | > 104 |
+-------+-------+
| > 240 | > 115 |
+-------+-------+
| > 260 | > 126 |
+-------+-------+
| > 280 | > 137 |
+-------+-------+
| > 300 | > 148 |
+-------+-------+

> 此程序中仍然只包括一个名为 main 的函数定义。它比前面打印"hello,
> world"的程序
>
> 长一些，但并不复杂。这个程序中引入了一些新的概念，包括注释、声明、变量、算术表达
>
> 式、循环以及格式化输出。该程序如下所示：

\#include \<stdio.h\>

+---------------------------+---+
|                           | { |
+===========================+===+
| > int fahr, celsius;      |   |
+---------------------------+---+
| > int lower, upper, step; |
+---------------------------+---+

fahr = lower;

> while (fahr \<= upper) {
>
> celsius = 5 \* (fahr-32) / 9; printf(\"%d\\t%d\\n\", fahr, celsius);
> fahr = fahr + step;
>
> }

}

> 其中的两行：

/\*当 fahr=0，20，... ，300 时，分别

> 打印华氏温度与摄氏温度对照表 \*/
>
> 称为注释，此处，它简单地解释，该程序是做什么用的。包含在/\*与\*/之间的字符序列将被
> 编译器忽略。注释可以自由地运用在程序中，使得程序更易于理解。程序中允许出现空格、
> 制表符或换行符之处，都可以使用注释。
>
> 在 C
> 语言中，所有变量都必须先声明后使用。声明通常放在函数起始处，在任何可执行
> 语句之前。声明用于说明变量的属性，它由一个类型名和一个变量表组成，例如：

int fahr, celsius;

int lower, upper, step;

> 其中，类型 int 表示其后所列变量为整数，与之相对应的，float
> 表示所列变量为浮点数（即， 可以带有小数部分的数）。int 与 float
> 类型的取值范围取决于具体的机器。对于 int 类型， 通常为 16
> 位，其取值范围在-32768～32767 之间，也有用 32 位表示的 int 类型。float
> 类 型通常是 32 位，它至少有 6 位有效数字，取值范围一般在 10-38～1038
> 之间。

除 int 与 float 类型之外，C 语高还提供了其它一些基本数据类型，例如：

char 字符------一个字节

short 短整型

long 长整型

> double 双精度浮点型
>
> 这些数据类型对象的大小也取决于具体的机器。另外，还存在这些基本数据类型的数组、结
> 构、联合，指向这些类型的指针以及返回这些类型值的函教。我们将在后续相应的章节中分
> 别介绍。

在上面的温度转换程序中，最开始执行的计算是下列 4 个赋值语句：

lower = 0;

upper = 300;

step = 20; fahr = lower;

它们为变量设置初值。各条语句均以分号结束。

> 温度转换表中的各行计算方式相同，因此可以用循环语句重复输出各行。这是
> while 循 环语句的用途：

while (fahr \<= upper) {

> \...

}

> while 循环 语 句 的 执 行 方式是 这 样 的 ： 首 先 测试 圆 括 号中 的
> 条 件； 如 果 条 件 为 真 (fahr\<=upper)，则执行循环体（括在花括号中的
> 3 条语句）；然后再重新测试圆括号中的
> 条件，如果为真，则再次执行循环体；当圆括号中的条件测试结果为假(fahr\>upper)时，
> 循环结束，并继续执行跟在 while
> 循环语句之后的下一条语句。在本程序中，循环语句后没
> 有其它语句，因此整个程序的执行终止。
>
> while
> 语句的循环体可以是用花括号括起来的一条或多条语句（如上面的温度转换程
> 序），也可以是不用花括号包括的单条语句，例如：
>
> while (i \< j) i = 2 \* i;
>
> 在这两种情况下，我们总是把由 while
> 控制的语句缩进一个制表位，这样就可以很容易地看
> 出循环语句中包含哪些语句。这种缩进方式突出了程序的逻辑结构。尽管 C
> 编译器并不关心
> 程序的外观形式，但正确的缩进以及保留适当空格的程序设计风格对程序的易读性非常重要。
> 我们建议每行只书写一条语句，并在运算符两边各加上一个空格字符，这样可以使得运算的
> 结合关系更清楚明了。相比而言，花括号的位置就不那么重要了。我们从比较流行的一些风
> 格中选择了一种，读者可以选择适合自己的一种风格，并养成一直使用这种风格的好习惯。

在该程序中，绝大部分工作都是在循环体中完成的。循环体中的赋值语句

celsius = 5 \* (fahr - 32) / 9：

> 用于计算与指定华氏温度相对应的摄氏温度值，并将结果赋值给变量
> celsius。在该语句中， 之所以把表达式写成先乘 5 然后再除以 9
> 而不是直接写成 5 / 9，其原因是在 C 语言及许多
> 其它语言中，整数除法操作将执行舍位，结果中的任何小数部分都会被舍弃。由于
> 5 和 9 都 是整数，5 / 9 相除后经截取所得的结果为
> 0，因此这样求得的所有摄氏温度都将为 0。
>
> 从该例子中也可以看出 printf 函数的一些功能。printf
> 是一个通用输出格式化函数， 第 7
> 章将对此做详细介绍。该函数的第一个参数是待打印的字符串，其中的每个百分号（%）
> 表示其它的参数（第二个、第三个、......参数）之一进行替换的位置，并指定打印格式。例
> 如，%d 指定一个整型参数，因此语句

printf(\" %d\\t%d\\n\", fahr, celsius);

用于打印两个整数 fahr 与 celsius
的值，并在两者之间留一个制表符的空间（\\t）。

printf
函数的第一个参数中的各个%分别对应于第二个、第三个、......参数，它们在数

> 目和类型上都必须匹配，否则将出现错误的结果。

顺便指出，printf 函数并不是 C 语言本身的一部分，C
语言本身并没有定义输入／输出

> 功能。printf 仅仅是标准库函数中一个有用的函数而已，这些标准序函数在 C
> 语言程序中 通常都可以使用。但是，ANSI 标准定义了 printf
> 函数的行为，因此，对每个符合该标准的
> 编译器和库来说，该函数的属性都是相同的。
>
> 为了将重点放到讲述 C 语言本身上，我们在第 7
> 章之前的各章中将不再对输入／输出做
> 更多的介绍，并且，特别将格式化输入推后到第 7
> 章讲解。如果读者想了解数据输入，可以 先阅读 7.4 节中对 scanf
> 函数的讨论部分，scanf 函数类似于 printf 函数，但它用于读输
> 入数据而不是写输出数据。

上述的温度转换程序存在两个问题。比较简单的问题是，由于输出的数不是右对齐的，

> 所以输出的结果不是很美观。这个问题比较容易解决：如果在 printf
> 语句的第一个参数的
>
> \%d 中指明打印宽度，则打印的数字会在打印区域内右对齐。例如，可以用语句

printf(\" %3d %6d\\n\", fahr, celsius);

> 打印 fahr 与 celsius 的值，这样，fahr 的值占 3 个数字宽，celsius
> 的值占 6 个数字宽， 输出的结果如下所示：

+--------+-------+
| 0      | > -17 |
+========+=======+
| > 20   | > -6  |
+--------+-------+
| > 40   | 4     |
+--------+-------+
| > 60   | > 15  |
+--------+-------+
| > 80   | > 26  |
+--------+-------+
| > 100  | > 37  |
+--------+-------+
| > \... |       |
+--------+-------+

> 另一个较为严重的问题是，由于我们使用的是整型算术运算，因此经计算得到的摄氏温
> 度值不太精确，例如，与
> 0℉对应的精确的摄氏温度应该为-17.8℃，而不是-17℃。为了得到
> 更精确的结果，应该用浮点算术运算代替上面的整型算术运算。这就需要对程序做适当修改。
> 下面是该程序的又一种版本
>
> \#include \<stdio.h\>
>
> /\* print Fahrenheit-Celsius table
>
> for fahr = 0, 20, \..., 300; floating-point version \*/ main()
>
> {
>
> float fahr, celsius; float lower, upper, step;
>
> lower = 0; /\* lower limit of temperatuire scale \*/ upper = 300; /\*
> upper limit \*/
>
> step = 20; /\* step size \*/
>
> fahr = lower;
>
> while (fahr \<= upper) {
>
> celsius = (5.0/9.0) \* (fahr-32.0); printf(\"%3.0f %6.1f\\n\", fahr,
> celsius); fahr = fahr + step;
>
> }
>
> }
>
> 这个程序与前一个程序基本相同，不同的是，它把 fahr 与 celsius 声明为
> float 类
> 型，转换公式的表述方式也更自然一些。在前一个程序中，之所以不能使用 5 /
> 9 的形式， 是因为按整型除法的计算规则，它们相除并舍位后得到的结果为
> 0。但是，常数中的小数点表
>
> 明该常数是一个浮点数，因此，5.0 / 9.0
> 是两个浮点数相除，结果将不被舍位。
>
> 如果某个算术运算符的所有操作数均为整型，则执行整型运算。但是，如果某个算术运
> 算符有一个浮点型操作数和一个整型操作数，则在开始运算之前整型操作数将会被转换为浮
> 点型。例如，在表达式 fahr -- 32 中，32
> 在运算过程中将被自动转换为浮点数再参与运算。
> 不过，即使浮点常量取的是整型值，在书写时最好还是为它加上一个显式的小数点，这样可
> 以强调其浮点性质，便于阅读。

第 2 章将详细介绍把整型数转换为浮点型数的规则。在这里需要注意，赋值语句

fahr = lower;

> 与条件测试语句

while (fahr \<= upper)

> 也都是按照这种方式执行的，即在运算之前先把 int 类型的操作数转换为
> float 类型的操作 数。
>
> printf 中的转换说明%3.0f 表明待打印的浮点数（即 fahr）至少占 3
> 个字符宽，且不 带小数点和小数部分；%6.1f
> 表明另一个待打印的数（celsius）至少占 6 个字符宽，且小 数点后面有 1
> 位数字。其输出如下所示：

+--------+---------+
| > 0    | > -17.8 |
+========+=========+
| > 20   | > -6.7  |
+--------+---------+
| > 40   | > 4.4   |
+--------+---------+
| > \... |         |
+--------+---------+

> 格式说明可以省略宽度与精度，例如，%6f 表示待打印的浮点数至少有 6
> 个字符宽；%.2f
> 指定待打印的浮点数的小数点后有两位小数，但宽度没有限制；%f
> 则仅仅要求按照浮点数打 印该数。

\%d 按照十进制整型数打印

\%6d 按照十进制整型数打印，至少 6 个字符宽

\%f 按照浮点数打印

\%6f 按照浮点数打印，至少 6 个字符宽

\%.2f 按照浮点数打印，小数点后有两位小数

\%6.2f 按照浮点数打印，至少 6 个字符宽，小数点后有两位小数

> 此外，printf 函数还支持下列格式说明：%o 表示八进制数；%x
> 表示十六进制数；%c 表示字符；%s 表示字符串；%%表示百分号（%）本身。
>
> **练习 1-3** 修改温度转换程序，使之能在转换表的顶部打印一个标题。
>
> **练习 1-4** 编写一个程序打印摄氏温度转换为相应华氏温度的转换表。
